version: "3.9"
services:
  api:
    build:
      context: ..
      dockerfile: docker/Dockerfile.api
    environment:
      - AZURE_OPENAI_API_KEY=${AZURE_OPENAI_API_KEY:-}
      - AZURE_OPENAI_ENDPOINT=${AZURE_OPENAI_ENDPOINT:-}
      - AZURE_OPENAI_API_VERSION=${AZURE_OPENAI_API_VERSION:-2024-02-15-preview}
      - AZURE_OPENAI_CHAT_DEPLOYMENT=${AZURE_OPENAI_CHAT_DEPLOYMENT:-}
      - AZURE_OPENAI_EMBED_DEPLOYMENT=${AZURE_OPENAI_EMBED_DEPLOYMENT:-}
      - RAG_CONFIG_PATH=/app/configs/config.yaml
    ports:
      - "8000:8000"
    volumes:
      - ../data:/app/data
      - ../configs:/app/configs
  ui:
    build:
      context: ..
      dockerfile: docker/Dockerfile.ui
    environment:
      - RAG_API_BASE=http://api:8000
    ports:
      - "8501:8501"
    depends_on:
      - api
